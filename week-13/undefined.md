# 🔸 보충 학습

## jpa 방식 - db 스키마 직접 입력

jpa 방식은 무조건 ddl방식으로 스키마를 자동 생성하지 않고,  db스키마를 직접 입력하기도 한다.

1. db스키마 직접 생성하는 경우 이점\
   1\) 직접 SQL을 작성하면 데이터베이스 스키마를 더 세밀하게 제어할 수 있다. 복잡한 스키마 또는 특정한 요구 사항을 충족하기 위해 세부적인 조정이 필요한 경우에 유용하다.\
   \
   2\) 어떤 ORM 도구를 사용하더라도 직접 SQL을 작성하면 데이터베이스에 대한 특정한 종속성을 줄일 수 있다. ORM 도구를 변경하거나 다른 프레임워크로 마이그레이션할 때 유용하다.\
   \
   3\) 프로덕션 환경에서는 보안 및 안정성을 고려하여 DDL을 자동 생성하는 것이 권장되지 않을 수 있다. 스키마를 직접 관리함으로써 운영 환경의 일관성을 유지할 수 있다.\

2. DDL 방식의 이점\
   1\) 별도로 스키마를 작성할 필요가 없기 때문에 간편하다.\
   \
   2\) 빠르게 프로토타입을 만들고 검증할 수 있다.\
   \
   3\) 엔티티 클래스 변경이 있을때, 관련 사항만 변경하면 되므로 유지보수에 용이하다.\

3. 일반적으로는 초기 개발 단계에서는 DDL 생성 기능을 사용하여 빠르게 프로토타입을 만들고, 운영 환경에서는 스키마 관리의 일관성을 위해 직접 SQL을 작성하는 것이 바람직할 수 있다.\
   참고로 postgresql은 ddl과 직접입력 두가지 방식을 모두 적용할 수 있다.

## @Embedded / @EmbeddedId

## @AttributeOverride

자신의 원래 클래스에서의 이름은 예를들어 "id"인데, 상위클래스에서는 "product\_id"로 이름을 지정하고 싶을때 이 애너테이션을 사용한다.

## VO클래스는 equals와 hashCode는 꼭 만들어야한다.

## BackDoorAPI

E2E 테스트에서 DB를 초기화(db삭제 SQL 포함)해야 하므로, 이를 지원하기 위한 Backdoor API를 만든다. 사실 꼭 E2E 테스트가 아니라고 해도, 개발 환경에서 API가 잘 작동하는지 쉽게 확인하기 위해 필요하다.

## N+1문제

@ManyToOne으로 연결하고 “Fetch” Join하거나, SQL을 직접 또는 간접적으로 써서 Command가 아닌 Query의 효율을 높이는 방법이 있다. 후자의 아이디어를 더 적극적으로 발전시키면 이전에 배운 CQRS 등으로 나아갈 수도 있다.
