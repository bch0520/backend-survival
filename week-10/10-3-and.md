# π”Έ 10-3 JWT & Autority

## JWT

* μ •μ \
  JWT λ” JSON Web Tokenμ μ•½μλ΅ μ „μ μ„λ… λ URL-safe (URLλ΅ μ΄μ©ν•  μμλ” λ¬Έμ λ§ κµ¬μ„±λ)μ JSONμ΄λ‹¤. μ „μ μ„λ…μ€ JSON μ λ³€μ΅°λ¥Ό μ²΄ν¬ ν•  μ μκ²λμ–΄ μλ‹¤.\
  JWTλ” μ†μ„± μ •λ³΄ (Claim)λ¥Ό JSON λ°μ΄ν„° κµ¬μ΅°λ΅ ν‘ν„ν• ν† ν°μΌλ΅ RFC7519 ν‘μ¤€μ΄λ‹¤.\

*   κµ¬μ„±\
    JWTλ” μ„Έ ννΈλ΅ λ‚λ„μ–΄μ§€λ©°, κ° ννΈλ” μ λ΅ κµ¬λ¶„ν•μ—¬ xxxxx.yyyyy.zzzzz μ΄λ°μ‹μΌλ΅ ν‘ν„λ©λ‹λ‹¤. μμ„λ€λ΅ ν—¤λ” (Header), νμ΄λ΅λ“ (Payload), μ„λ… (Sinature)λ΅ κµ¬μ„±ν•©λ‹λ‹¤.\
    &#x20;Base64 μΈμ½”λ”©μ κ²½μ° β€+β€, β€/β€, β€=β€μ΄ ν¬ν•¨λμ§€λ§ JWTλ” URIμ—μ„ νλΌλ―Έν„°λ΅ μ‚¬μ©ν•  μ μλ„λ΅ URL-Safe ν•  Base64url μΈμ½”λ”©μ„ μ‚¬μ©ν•©λ‹λ‹¤.\


    Headerλ” ν† ν°μ νƒ€μ…κ³Ό ν•΄μ‹ μ•”νΈν™” μ•κ³ λ¦¬μ¦μΌλ΅ κµ¬μ„±λμ–΄ μμµλ‹λ‹¤. μ²«μ§Έλ” ν† ν°μ μ ν• (JWT)μ„ λ‚νƒ€λ‚΄κ³ , λ‘ λ²μ§Έλ” HMAC, SHA256 λλ” RSAμ™€ κ°™μ€ ν•΄μ‹ μ•κ³ λ¦¬μ¦μ„ λ‚νƒ€λ‚΄λ” λ¶€λ¶„μ…λ‹λ‹¤.\
    \
    Payloadλ” ν† ν°μ— λ‹΄μ„ ν΄λ μ„(claim) μ •λ³΄λ¥Ό ν¬ν•¨ν•κ³  μμµλ‹λ‹¤. Payload μ— λ‹΄λ” μ •λ³΄μ ν• β€μ΅°κ°β€™ μ„ ν΄λ μ„μ΄λΌκ³  λ¶€λ¥΄κ³ , μ΄λ” name / value μ ν• μμΌλ΅ μ΄λ¤„μ Έμμµλ‹λ‹¤. ν† ν°μ—λ” μ—¬λ¬κ°μ ν΄λ μ„ λ“¤μ„ λ„£μ„ μ μμµλ‹λ‹¤.\
    ν΄λ μ„μ μ •λ³΄λ” λ“±λ΅λ (registered) ν΄λ μ„, κ³µκ° (public) ν΄λ μ„, λΉ„κ³µκ° (private) ν΄λ μ„μΌλ΅ μ„Έ μΆ…λ¥κ°€ μμµλ‹λ‹¤.\
    \
    λ§μ§€λ§‰μΌλ΅ Signatureλ” secret keyλ¥Ό ν¬ν•¨ν•μ—¬ μ•”νΈν™”λμ–΄ μμµλ‹λ‹¤.

<figure><img src="../.gitbook/assets/α„‰α…³α„α…³α„…α…µα†«α„‰α…£α†Ί 2024-04-06 α„‹α…©α„’α…® 6.44.26.png" alt="" width="563"><figcaption></figcaption></figure>

*   νΉμ§•(μ¥/λ‹¨μ )\
    \[μ¥μ ]

    * URL  νλΌλ―Έν„°μ™€ ν—¤λ”λ΅ μ‚¬μ©
    * μν‰ μ¤μΌ€μΌμ΄ μ©μ΄
    * λ””λ²„κΉ… λ° κ΄€λ¦¬κ°€ μ©μ΄
    * νΈλν”½ λ€ν• λ¶€λ‹΄μ΄ λ‚®μ
    * REST μ„λΉ„μ¤λ΅ μ κ³µ κ°€λ¥
    * λ‚΄μ¥λ λ§λ£
    * λ…λ¦½μ μΈ JWT\


    \[λ‹¨μ ]

    * ν† ν°μ€ ν΄λΌμ΄μ–ΈνΈμ— μ €μ¥λμ–΄ λ°μ΄ν„°λ² μ΄μ¤μ—μ„ μ‚¬μ©μ μ •λ³΄λ¥Ό μ΅°μ‘ν•λ”λΌλ„ ν† ν°μ— μ§μ ‘ μ μ©ν•  μ μ—†μµλ‹λ‹¤.
    * λ” λ§μ€ ν•„λ“κ°€ μ¶”κ°€λλ©΄ ν† ν°μ΄ μ»¤μ§ μ μμµλ‹λ‹¤.
    * λΉ„μƒνƒ μ• ν”λ¦¬μΌ€μ΄μ…μ—μ„ ν† ν°μ€ κ±°μ λ¨λ“  μ”μ²­μ— λ€ν•΄ μ „μ†΅λλ―€λ΅ λ°μ΄ν„° νΈλν”½ ν¬κΈ°μ— μν–¥μ„ λ―ΈμΉ  μ μμµλ‹λ‹¤.


* μ‚¬μ©λ°©λ²•\
  JWTλ” μ„λ²„μ™€ ν΄λΌμ΄μ–ΈνΈ κ°„ μ •λ³΄λ¥Ό μ£Όκ³  λ°›μ„ λ• Http λ¦¬ν€μ¤νΈ ν—¤λ”μ— JSON ν† ν°μ„ λ„£μ€ ν›„ μ„λ²„λ” λ³„λ„μ μΈμ¦ κ³Όμ •μ—†μ΄ ν—¤λ”μ— ν¬ν•¨λμ–΄ μλ” JWT μ •λ³΄λ¥Ό ν†µν•΄ μΈμ¦ν•λ‹¤. \
  μ΄λ• μ‚¬μ©λλ” JSON λ°μ΄ν„°λ” URL-Safe ν•λ„λ΅ URLμ— ν¬ν•¨ν•  μ μλ” λ¬Έμλ§μΌλ΅ λ§λ“ λ‹¤. \
  JWTλ” HMAC μ•κ³ λ¦¬μ¦μ„ μ‚¬μ©ν•μ—¬ λΉ„λ°€ν‚¤ λλ” RSAλ¥Ό μ΄μ©ν• Public Key/ Private Key μμΌλ΅ μ„λ…ν•  μ μλ‹¤.\

* λ νΌλ°μ¤ λ¨μ\
  [http://www.opennaru.com/opennaru-blog/jwt-json-web-token/](http://www.opennaru.com/opennaru-blog/jwt-json-web-token/)

## Claims-based identity

* μ •μ \
  ν΄λ μ„ κΈ°λ° IDλ” μ μ ν•κ³  κ΄€λ ¨λ μƒνΈ μ‘μ©μ„ μ„ν•΄ μ—”ν„°ν‹°μ— κ¶ν•μ„ λ¶€μ—¬ν•λ” λ°μ΄ν„°λ¥Ό μ κ³µν•λ” λ™μ‹μ— μ—”ν„°ν‹°μ νΉμ • μ •λ³΄λ¥Ό μ¶”μƒν™”ν•λ” λ°©μ‹μΌλ΅ μµμΆ… μ‚¬μ©μ, μ• ν”λ¦¬μΌ€μ΄μ… λλ” μ¥μΉλ¥Ό λ‹¤λ¥Έ μ‹μ¤ν…μ— μΈμ¦ν•λ” μλ‹¨μ΄λ‹¤.\

* μ™ ν•„μ”ν•κ°€?\
  μ‚¬μ©μ μ •λ³΄λ¥Ό μλ™μΌλ΅ μ κ³µν•λ―€λ΅ μ• ν”λ¦¬μΌ€μ΄μ…μ΄ μ‚¬μ©μμ—κ² μ΄λ¥Ό μ”μ²­ν•  ν•„μ”κ°€ μ—†μΌλ©° μ‚¬μ©μλ” ν•΄λ‹Ή μ •λ³΄λ¥Ό λ‹¤λ¥Έ μ• ν”λ¦¬μΌ€μ΄μ…μ— λ³„λ„λ΅ μ κ³µν•  ν•„μ”κ°€ μ—†λ‹¤.\

*   νΉμ§•(μ¥μ )\


    * **μ•„μ›ƒμ†μ‹± μΈμ¦**\
      ν΄λ μ„ κΈ°λ° IDλ¥Ό μ‚¬μ©ν•λ©΄ μ• ν”λ¦¬μΌ€μ΄μ…μ΄ μΈμ¦ μ‘μ—…μ„ μν–‰ν•  ν•„μ”κ°€ μ—†μΌλ―€λ΅ μΈμ¦μ„ μ¤‘μ•™ μ§‘μ¤‘ν™”ν•μ—¬ κ³„μ • κ΄€λ¦¬κ°€ λ” μ‰¬μ›μ§„λ‹¤. μ• ν”λ¦¬μΌ€μ΄μ…μ€ μ‚¬μ©μ μΈμ¦, μ‚¬μ©μ μ‹ μ› μ„Έλ¶€μ •λ³΄ μ΅°ν, μ‚¬μ©μ κ³„μ • λ° λΉ„λ°€λ²νΈ μ €μ¥ λλ” λ‹¤λ¥Έ μ‹ μ› μ‹μ¤ν…κ³Όμ ν†µν•©μ— λ€ν• μ±…μ„μ„ μ§€μ§€ μ•λ”λ‹¤. λν• μΈμ¦μ„ μ¤‘μ•™ μ§‘μ¤‘ν™”ν•λ©΄ μ• ν”λ¦¬μΌ€μ΄μ…μ„ λ³΄λ‹¤ κ°•λ ¥ν• μΈμ¦ λ°©λ²•μΌλ΅ μ—…κ·Έλ μ΄λ“ν•κΈ°κ°€ λ” μ‰¬μ›μ§„λ‹¤.
    * **μ—¬λ¬ μΈμ¦ κ³µκΈ‰μλ¥Ό μ§€μ›**\
      ν΄λ μ„ κΈ°λ° IDλ¥Ό μ‚¬μ©ν•λ©΄ νμ‚¬λ” Microsoft κ³„μ •, Windows AD(Active Directory) μΈμ¦ λλ” μ›Ή μ‚¬μ΄νΈμ— λ€ν• μ–‘μ‹ κΈ°λ° μΈμ¦κ³Ό κ°™μ€ λ‹¤μ–‘ν• κ³µκΈ‰μλ¥Ό μ‚¬μ©ν•μ—¬ λ‹¤μ–‘ν• μΈμ¦ λ°©λ²•μ„ μ‰½κ² κµ¬ν„ν•  μ μλ‹¤. μ΄λ” SSO( [Single Sign-On](https://www.techtarget.com/searchsecurity/answer/Best-practices-for-deploying-enterprise-single-sign-on-SSO) )λ¥Ό μ‚¬μ©ν•μ—¬ μ΅°μ§ λ‚΄μ—μ„ λλ” μ ν΄ μ΅°μ§μ„ ν†µν•΄ μΈν„°λ„·μ„ ν†µν•΄ μ›Ή μ„λΉ„μ¤ λλ” μ›Ή μ• ν”λ¦¬μΌ€μ΄μ…μ— μ•΅μ„Έμ¤ν•λ” μ‚¬μ©μλ¥Ό μ§€μ›ν•κΈ° μ„ν•΄ μν–‰λλ‹¤ .
    * **ID νλ”λ μ΄μ…μ„ μ§€μ›**\
      ν΄λ μ„ κΈ°λ° IDλ¥Ό μ‚¬μ©ν•λ©΄ ν• μ΅°μ§μ μ™Έλ¶€ μ‚¬μ©μκ°€ μμ‹ μ IDλ¥Ό μ‚¬μ©ν•μ—¬ λ‹¤λ¥Έ νμ‚¬μ λ„¤νΈμ›ν¬ μ• ν”λ¦¬μΌ€μ΄μ…μ— μ•΅μ„Έμ¤ν•  μ μλ‹¤.


* μ‘λ™ ν”„λ΅μ„Έμ¤
  1. μ‚¬μ©μκ°€ μ• ν”λ¦¬μΌ€μ΄μ…μ— λ€ν• μ•΅μ„Έμ¤λ¥Ό μ”μ²­.
  2. μ• ν”λ¦¬μΌ€μ΄μ…μ€ ν•΄λ‹Ή μ‚¬μ©μμ ν† ν°μ— λ€ν• μ”μ²­μ„ STSμ— λ³΄λ‚Έλ‹¤.
  3. STSλ” λΉ„λ°€λ²νΈ, μƒμ²΄ μΈμ‹ μ¤μΊ”, μ¤λ§νΈ μΉ΄λ“ λ“±μ„ μ‚¬μ©ν•΄ μ‚¬μ©μλ¥Ό μΈμ¦.
  4. STSκ°€ ν† ν°μ„ μƒμ„±.
  5. STSλ” ν† ν°μ— λ””μ§€ν„Έ λ°©μ‹μΌλ΅ μ„λ…ν•κ³  λ””μ§€ν„Έ μ„λ…μ€ ν† ν°μ μΌλ¶€κ°€ λλ‹¤.
  6. STSλ” μ΄λ¥Ό μ”μ²­ν• μ• ν”λ¦¬μΌ€μ΄μ…μ— ν† ν°μ„ λ‹¤μ‹ λ³΄λ‚Έλ‹¤.
  7. μ• ν”λ¦¬μΌ€μ΄μ…μ€ λ””μ§€ν„Έ μ„λ…μ μ ν¨μ„±μ„ ν™•μΈν•κ³  μ„λΉ„μ¤ λλ” μ• ν”λ¦¬μΌ€μ΄μ…μ΄ μ‹ λΆ°ν•λ” STSμ—μ„ λ‚μ¨ κ²ƒμΈμ§€ ν™•μΈ.
  8. μ‘μ© ν”„λ΅κ·Έλ¨μ€ ν΄λ μ„ λ°μ΄ν„°λ¥Ό μ²λ¦¬ν•μ—¬ μ‚¬μ©μκ°€ μ‘μ© ν”„λ΅κ·Έλ¨μ— μ•΅μ„Έμ¤ν•λ„λ΅ ν—μ©ν• μ§€ μ—¬λ¶€μ™€ μ‚¬μ©μκ°€ κ°–κ² λ  μ•΅μ„Έμ¤ μμ¤€μ„ κ²°μ •.\

* λ νΌλ°μ¤ λ¨μ\
  [https://www.techtarget.com/searchsecurity/definition/claims-based-identit](https://www.techtarget.com/searchsecurity/definition/claims-based-identit)\


## λ€μΉ­ν‚¤ μ•”νΈν™” / κ³µκ°ν‚¤ μ•”νΈν™”

* μ •μ (μ°¨μ΄μ )\
  λ€μΉ­ν‚¤ μ•”νΈν™” λ°©μ‹μ€ μ•”λ³µνΈν™”μ— μ‚¬μ©ν•λ” ν‚¤κ°€ λ™μΌν• μ•”νΈν™” λ°©μ‹μ„ λ§ν•λ‹¤. κ·Έμ™€ λ‹¬λ¦¬, κ³µκ°ν‚¤ μ•”νΈν™” λ°©μ‹μ€ μ•”λ³µνΈν™”μ— μ‚¬μ©ν•λ” ν‚¤κ°€ μ„λ΅ λ‹¤λ¥΄λ©° λ”°λΌμ„ λΉ„λ€μΉ­ν‚¤ μ•”νΈν™”λΌκ³ λ„ ν•λ‹¤. λ”°λΌμ„ κ³µκ°ν‚¤ μ•”νΈν™” μ—μ„λ” μ†΅μμ‹ μ λ¨λ‘ ν•μμ ν‚¤(κ°μΈν‚¤, κ³µκ°ν‚¤)λ¥Ό κ°–κ³ μκ² λλ‹¤.

<figure><img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&#x26;fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FmG9CN%2FbtqDO03YbR1%2FjCAXKIZm7G06yek6bLPTk1%2Fimg.png" alt="" width="563"><figcaption></figcaption></figure>

*   νΉμ§•\
    \[λ€μΉ­ν‚¤ μ¥/λ‹¨μ ]\
    κ³µκ°ν‚¤ μ•”νΈν™” λ°©μ‹μ— λΉ„ν•΄ μ†λ„κ°€ λΉ λ¥΄λ‹¤λ” μ¥μ μ΄ μμ§€λ§, ν‚¤λ¥Ό κµν™ν•΄μ•Όν•λ‹¤λ” λ¬Έμ  (ν‚¤ λ°°μ†΅ λ¬Έμ )κ°€ λ°μƒν•λ‹¤. ν‚¤λ¥Ό κµν™ν•λ” μ¤‘ ν‚¤κ°€ νƒμ·¨λ  μ μλ” λ¬Έμ λ„ μκ³  μ‚¬λμ΄ μ¦κ°€ν• μλ΅ μ „λ¶€ λ”°λ΅λ”°λ΅ ν‚¤κµν™μ„ ν•΄μ•Όν•κΈ° λ•λ¬Έμ— κ΄€λ¦¬ν•΄μ•Ό ν•  ν‚¤κ°€ λ°©λ€ν•κ² λ§μ•„μ§„λ‹¤.

    μ΄λ¬ν• ν‚¤ λ°°μ†΅ λ¬Έμ λ¥Ό ν•΄κ²°ν•κΈ° μ„ν• λ°©λ²•μΌλ΅ ν‚¤μ μ‚¬μ „ κ³µμ μ— μν• ν•΄κ²°, ν‚¤ λ°°ν¬μ„Όν„°μ— μν• ν•΄κ²°, Diffie-Hellman ν‚¤ κµν™μ— μν• ν•΄κ²°, κ³µκ°ν‚¤ μ•”νΈμ— μν• ν•΄κ²°μ΄ μλ‹¤.\
    \
    \[κ³µκ°ν‚¤ μ¥/λ‹¨μ ]\
    κ³µκ°ν‚¤λ” ν‚¤κ°€ κ³µκ°λμ–΄μκΈ° λ•λ¬Έμ— λ”°λ΅ ν‚¤κµν™μ΄λ‚ λ¶„λ°°λ¥Ό ν•  ν•„μ”κ°€ μ—†μ–΄μ§„λ‹¤. μ¤‘κ°„ κ³µκ²©μκ°€ Bμ κ³µκ°ν‚¤λ¥Ό μ–»λ”λ‹¤κ³  ν•΄λ„ Bμ κ°μΈν‚¤λ΅λ§ λ³µνΈν™”κ°€ κ°€λ¥ν•κΈ° λ•λ¬Έμ— κΈ°λ°€μ„±μ„ μ κ³µν•λ©° κ°μΈν‚¤λ¥Ό κ°€μ§€κ³ μλ” μμ‹ μλ§μ΄ μ•”νΈν™”λ λ°μ΄ν„°λ¥Ό λ³µνΈν™”ν•  μ μμΌλ―€λ΅ μΌμΆ…μ μΈμ¦κΈ°λ¥λ„ μ κ³µν•λ‹¤λ” μ¥μ μ΄ μλ‹¤. κ·Έμ— λ°ν•΄ λ‹¨μ μ€ μ†λ„κ°€ λλ¦¬λ‹¤λ” κ²ƒμ΄λ‹¤.\

* λ νΌλ°μ¤ λ¨μ\
  [https://www.uname.in/129](https://www.uname.in/129)

## `@Secured`

* μ •μ \
  μ ‘κ·Όκ¶ν•μ„ λ¶€μ—¬ν•  λ• μΆ€ λ” νΈν•κ³  μ§κ΄€μ μΌλ΅ ν•κΈ° μ„ν•΄μ„ μ‚¬μ©ν•λ” μ–΄λ…Έν…μ΄μ…μ΄λ‹¤.\
  `@Secured` μ–΄λ…Έν…μ΄μ…μ€ κ¶ν•μ΄ ν•„μ”ν• λ¶€λ¶„μ—λ§ μ„ μ–Έν•λ©΄ λλ”λ°, `Class`λ‚ `Method` λ‹¨μ„κΉμ§€ μ§€μ •μ„ ν•  μ μλ‹¤. μλ¥Ό λ“¤λ©΄ `ROLE_ADMIN`λ§ μ ‘κ·Όμ‹ν‚¬ λ©”μ„λ“κ°€ μλ‹¤λ©΄ ν•΄λ‹Ή λ©”μ„λ“μ„μ— `@Secured` μ–΄λ…Έν…μ΄μ…μ„ μ„ μ–Έν•΄μ£ΌκΈ°λ§ ν•λ©΄ λλ‹¤.\

*   μ‚¬μ©μμ‹\


    ```java
    ex1)μ ‘κ·Ό κ°€λ¥ν• κ¶ν•μ΄ ν•λ‚ μΌλ•

    @Secured("ROLE_ADMIN")
    public String encoding(String str){
     return encoder.encodePassword(str,null);
    }

    ex2)μ ‘κ·Ό κ°€λ¥ν• κ¶ν•μ΄ λ‘κ° μ΄μƒμΌλ•

    @RequestMapping(value = "/checkAuth", method = RequestMethod.GET)
    @Secured({"ROLE_ADMIN","ROLE_USER"})
    public String checkAuth(Locale locale, Model model, Authentication auth) {
     UserDetailsVO vo = (UserDetailsVO) auth.getPrincipal();
     logger.info("Welcome checkAuth! Authentication is {}.", auth);
     logger.info("UserDetailsVO == {}.", vo);
     model.addAttribute("auth", auth );
     model.addAttribute("vo", vo );
     return "checkAuth";
    }
    ```


* λ νΌλ°μ¤ λ¨μ\
  [https://parkminkyu.github.io/@Secured-%EC%96%B4%EB%85%B8%ED%85%8C%EC%9D%B4%EC%85%98%EC%9D%84-%EC%82%AC%EC%9A%A9%ED%95%98%EC%97%AC-%EC%A0%91%EA%B7%BC-%EA%B6%8C%ED%95%9C-%EB%B6%80%EC%97%AC/](https://parkminkyu.github.io/@Secured-%EC%96%B4%EB%85%B8%ED%85%8C%EC%9D%B4%EC%85%98%EC%9D%84-%EC%82%AC%EC%9A%A9%ED%95%98%EC%97%AC-%EC%A0%91%EA%B7%BC-%EA%B6%8C%ED%95%9C-%EB%B6%80%EC%97%AC/)
