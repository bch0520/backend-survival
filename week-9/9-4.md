# 🔸 9-4 도메인 주도 설계 핵심 - 반 버논

## 내용 필사

기술은 아키텍처 전반에 걸쳐 산재해 있지만, 도메인 모델은 기술로부터 최대한 자유로워야 한다.\
\
핵심도메인은 다른 조직과 차별화를 위해 개발한다. 무엇이 핵심 도메인이고, 어떤 것을 제외시켜하는지 현명하게 선택해야 한다.

여러 바운디드 컨텍스트 중 하나는 핵심 도메인이 될 것이고, 다른 바운디드 컨텍스트에는 다양한 서브도메인이 존재할 것이다.

바운디드 컨텍스트 안에 오직 1개의 서브도메인을 두는 것을 목표로 한다. 만약 동일한 바운디드 컨텍스트 안에 다른 모델을 만들어야 하는 상황이라면, 핵심도메인으로부터 완전히 분리된 모듈 형태로 그 모델을 별도의 영역에 정의해야 한다.

애자일 프로젝트 관리 핵심은 하나의 바운디드 컨텍스트와 하나의 서브도메인 모두를 포함한다는 것이다.

서브도메인이란, 전체 비즈니스 도메인의 하위 부분으로, 비즈니스 도메인은 보통 너무 크고 복잡하기 때문에 비즈니스 도메인을 논리적으로 작개 쪼갠것이라고 할 수 있다. 또한 명확한 전문 지식 영역별로 나눌 수도 있다.\
\
서브도메인에는 세 가지 주요 서브도메인 유형이 있다.\
핵심도메인(차별화영역), 지원 서브도메인(맞춤 제작 개발 영역), 일반 서브도메인(기존 제품 충족 영역)

컨텍스트 매핑이란, 핵심 도메인을 다른 바운디드 컨텍스트와 통합하는 것을 말한다.

엔터티는 독립적인 것이며, 고유한 식별성을 갖는다. 다만, 엔터티는 변할 수 있는 것이며 변하지 않을 수도 있다.

애그리거트는 1개 이상의 엔터티, 애그리커트 루트(엔터티중 하나), VO(값객체)로 이루어진다.\
각 애그리거트는 일관성 있는 트랜잭션 경계를 형성한다.

VO는 불변 객체이며, 엔터티와는 달리 고유한 식별성은 없다.

도메인 이벤트는 바운디드 컨텍스트 내의 비즈니스 관점에서 중요한 사항들에 대한 기록이다. 전략적 설계를 위해 매우 중요한 도구이다.

이벤트 소싱은 애그리거트 인스턴스에 대해 변경된 것에 대한 기록으로, 발생했던 모든 도메인 이벤트를 저장하는 것을 말한다. 이벤트 소싱의 가장 큰 이점은 핵심 도메인에서 발생하는 모든 기록을 개별적으로 저장한다는 점이다.

이벤트 스토밍은 빠른 주기의 학습 과정에 도메인 전문가와 개발자 모두가 참여하는 신속한 설계 기술이다. 이는 명사나 데이터보다 비즈니스와 비즈니스 프로세스에 초점을 맞춘다.

\
컨텍스트 매핑의 종류
-----------

\
1\. 파트너십 - 서로 다른 두팀이  통합을 적절하게 유지하기 위해 지속적으로 노력한다.\
\
2\. 공유커널 - 2개 팀 사이에 작지만 공통인 모델을 공유한다.\
\
3\. 고객-공급자 - 공급자는 상류, 고객은 하류로 표현하며, 공급자가 주도적인 입장이다.\
\
4\. 준수자 - 상류와 하류 팀이 있고, 하류 팀이 상류팀의 보편언어를 일방적으로 따르는 모델이다.\
\
5\. 반부패 계층 - 가장 방어적인 컨텍스트 매핑 관계로, 하류 팀이 그들의 보편언어 모델과 상류팀의 보편언어 모델 사이에 번역 계층을 만드는 것이다.\
\
6\. 공개 호스트 서비스 - 일련의 서비스처럼 바운디드 컨텍스트에 접근을 제공하는 프로토콜이나 인터페이스를 정의 한다. 통합하고자 하는 모두가 용이하게 사용할 수 있도록 공개 돼 있다.\
\
7\. 공표된 언어 - 바운디드 컨텍스트의 규모에 관계없이, 모두 간단한 사용과 번역을 가능하게 하는 잘 문서화된 정보 교환 언어다. 두 보편언어 사이에 번역을 제공한다.\
\
8\. 각자의 길 - 1개 이상의 바운디드 컨텍스트를 통합으로 다양한 보편언어를 사용하는 것이 유의미한 결과를 제공하지 못하는 상황을 말한다.\
\
9\. 큰 진흙 덩어리 - 모델 내의 언어가 계속 확장되면서 점차 모호해지고 그런 것들이 많아지는 바운디드 컨텍스트 상태. 1개 이상의 큰 진흙 덩어리와 반드시 통합해야 한다면, 레거시 시스템에 대응하는 반부패 계층을 만들어서 우리들의 모델을 보호해야 한다.

## 컨텍스트 매핑의 신뢰할 수 있는 세 가지 통합 형태

1. SOAP를 이용한 RPC\
   다른 시스템이 서비스를 사용할 때 마치 단순히 로컬 프로시저나 메서드를 호출하는 것처럼 사용한다는 개념이다. 이 형태는 클라이언트 바운디드 컨텍스트와 서비스를 제공하는 바운디드 컨텍스트 상이의 강한 결합을 암시한다. \
   이것의 문제는 견고함이 떨어질 수 있다는 점이고, RPC가 제대로 동작만 한다면 통합하기 매우 좋은 방법이다. 필요하다면 반부패 계층을 정의한다.
2. 레스트풀 HTTP\
   바운디드 컨텍스트 간에 교환되는 리소소뿐만 아니라 POST, GET, PUT, DELETE 4가지 주요 오퍼레이션들이 관여된다.  이 방식은 분산 컴퓨팅에 적합한 API들을 정의하는데 도움을 주기 때문에 잘 동작한다. REST 인터페이스를 제공하는 서비스 바운디드 컨텍스트는 공개 호스트 서비스와 공표된 언어를 제공해야 한다. 이 방식은 지금까지 보여준 신뢰성, 확장성 등의 성공한 모습에 대해 흠 잡을 수 없다.
3. 메시징\
   통합에 비동기 메시징을 사용하면 우리의 바운디드 컨텍스트 또는 다른 바운디드 컨텍스트가 발행하는 도메인 이벤트를 구독하는 클라이언트 바운디드 컨텍스트가 많은 것을 할 수 있게 해준다. \
   메시징을 사용한 통합은 가장 견고한 형태 중 하나인데, 이는 RPC난 REST와 달리, 분절된 형태와의 일시적인 결합을 대부분 제거할 수 있기 때문이다. 즉각적인 결과가 필수적이지 않을 때는 메시징을 이용해 견고한 시스템을 구축하는 것도 좋은 선택이다. \
   메시징 메커니즘은 적어도 한번의 전달을 통해 모든 메시지의 수신을 보장해야 한다. 이는 구독 바운디 컨텍스트가 멱등 수신자로 구현돼야 함을 의미한다.\
   메시징 메커니즘이 항상 비동기 요청-응답 통신을 사용하기 때문에 어느 정도의 지연은 일반적이고 당연하다. 하지만 서비스가 종료되기 전에는 서비스에 대한 요청이 거의 막힐 일이 없기 때문에 지연을 감내 할 수 있다면 전체 솔루션을 매우 견고하게 만들 수 있다.

## 애그리커트 경험 법칙

1. 애그리거트 경계 내에서 비즈니스 불변사항들을 보호하라.(비즈니스 일관성이 지켜져야 한다.)
2. 작은 애그리커트를 설계하라.(이 부분은 단일 책임 원칙이 적용된다.)
3. 오직 ID(식별자)를 통해 다른 애그리커트를 참고하라.\
   (이 규칙은 더 적은 메모리 요구와 리파지토리로부터의 빠른 로딩을 통해 애그리거트 설계를 작고 효율적으로 할 수 있게 해주면, 동일 트랜잭션 내에 다른 애그리거트를  수정하지 않도록 해준다. 그리고 다양한 형테의 저장 메커니즘을 사용할 수 있다.)
4. 결과적 일관성을 사용해 다른 애그리거트를 갱신하라.

## 읽고 난 후 나의 생각

애자일에 관련된 스프린트, 스크럼 등의 낯선 용어들이 있어서 처음엔 이해하기 좀 생소했던 것 같다.\
완벽히 내용을 다 소화하고 코드에 적용할 순 없겠지만, 바운디드 컨텍스트에 핵심 도메인이 있고 그것을 어떻게 다른 바운디드 컨텍스트와 안정적으로 통합할 수 있는지에 대한 맛을 봤다고 표현하는게 좋을 것 같다.\
그리고 바운디드 컨텍스트 내의 애그리거트를 어떻게 설계할 것인지, 어떻게 참조할 것인지 등을 개괄적으로 알 수 있었던 것 같다. \
책으로만 읽으니 아직은 모호한 부분도 많아서, 이런것들을 코드로 어떻게 녹일 수 있을지 직접 생각해 보고 앞으로 익힐 수 있는 경험을 하면 좋을 것 같다.\
두꺼운 책은 아니었지만 기술서적을 정리하고 소화하는데 생각보다 에너지가 많이 소모됐던 것 같고, 그리고 처음으로 기술 서적을 완독해서 뿌듯함을 느꼈던 경험이었다.

## 용어 정리

**바운디드 컨텍스트**  \
의미적으로 동일한 컨텍스트의 범위를 표현, 문제영역(설계, 컨텍스트 맵 잘활용 하는 구간)에서 해결영역(구현)으로 전환. 바운디드 컨텍스트마다 각각 분리된 소프트웨어 산출물이 나온다. \
부서마다 실행하는 정책들이 있을때 그것을 동일한 바운디드 컨텍스트 선상에 넣지 말고 각각 별도로 구분한다.\
관련되지 않는 것들은 바운디드 켄텍스트에서 제외한다.\
\
**보편언어**\
소프트웨어 모델을 만드는 모든 팀 구성원이 사용하는 언어.\
보편언어는 엄격하고, 정확하고, 엄중하며, 단호해야 한다.

**진흑덩어리** \
모델 내의 언어가 확장되면서 점차 모호해지고 그런 것들이 많아지는 것을 일컫는 말.\
\


