# 🔸 9-3 조영호님 "우아한 객체 지향 세미나"

## 의존성이란?

B가 바뀌었을때 A도 바뀔수 있다는 것.\
하지만 설계를 잘하면 영향을 받지 않을 수도 있다.

## 클래스 의존성 종류

1. 연관관계 : 지속적인(영구적인) 관계, 빈번하게 데이터를 주고받는 관계. A->B라면, A를 알면 B를 찾아갈 수 있다.
2. 의존관계 : 일시적인 시점에만 발생하는 관계. 런타임에 어떻게 협력하는지에 따라 발생.(파라미터, 리턴타입, 지역변수)
3. 상속관계 (extends): A가 B를 상속받았다면 B가 바뀔때 A도 바뀐다.
4. 실체화관계(implements) : 인터페이스의 오퍼레이션 시그니처가 바뀔때만 관계가 바뀌는 것.&#x20;

## 좋은 의존성을 관리하기 위한 규칙

1. 양방향 의존성을 피하라
2. 다중성이 적은 방향을 선택하라.\
   ManytoOne보다 OnetoMany를 선택하라. 즉, 다수에 한개만 의존하게하고, 한개에 다수가 의존하게 하지마라.
3. 의존성이 필요없다면 제거하라.
4. 패키지 사이의 의존성 사이클을 제거하라.\
   A->B->C->A(X),  A->A(O)

## 배달 앱 도메인

의존성은 관계의 방향(협력의 방향, 의존성의 방향)이 있어야한다.(DB는 방향을 무시해도 된다.)

## 구현하기

1. 메소드를 만들때는 먼저, 메시지를 생각하고 메소드를 만든다. 즉, 어떤 기능을 할지를 먼저 생각.
2. 의존성 설계를 위해서 종이에 일단 그려보자.

## 의존성 설계 시 두 가지 문제&#x20;

1. 양방향 연관관계\
   해결방법 : 중간 객체를 만들어 의존성 사이클을 끊는다.(일종의 추상화, 추상화란 잘 변하지 않는 것을 말함)&#x20;
2. 객체참조로 구현한 연관관계의 문제점\
   1\) 객체가 모두 연결되어 있다보니 어디까지 읽고, 읽지 말아야할지 모호하다.(다른말로 트랜잭션의 경계가 어디까지 인가?)\
   shop, order, delivery 트랜잭션으로 묶여 있지만, 각각은 변경주기가 달라서 업데이트가 발생할 경우 트랜잭션 경합이 발생하여 성능이 저하된다.\
   객체참조를 통한 검색은 결합도가 너무 높다. 대신 repository를 통해 검색하면 결합도가 낮아진다.\
   해결방법 :\
   어떤 객체들을 묶고 분리할 것인가? \
   함께 생성되고 삭제되는 객체들과, 도메인 제약사항을 공유하는 객체를 하나의 트랜잭션으로 묶어라. 나머지는 분리하라.\
   ex) shop, menu(optionGroupSpecipication, optionSpecipication), order, delevery로 나누어서 묶는다.\
   _**그리고 경계밖의 객체는 Id를 이용해서 참조하면 된다.**_\
   shopRepository를 이용해서 탐색.\
   \
   2\) Id를 참조하는 순간 컴파일 에러가 발생한다.\
   해결방법 : 참조문제로 컴파일에러가 나는 코드들을 OrderValidator 클래스를 만들어서 그 곳에 다 모은다. 같이 변경되는 코드들이 모여있을때 응집도가 올라간다.\
   때로는 절차지향이 객체지향보다 좋을 때가 있다.\
   \
   3\) 도메인 로직의 순차적 실행으로 컴파일 에러가 난다.\
   해결방법 :\
   a. 절차지향적으로 코드를 한 곳에 모은다.\
   이때 양방향 의존 문제가 발생하는데, 의존성 역전을 이용해서 인터페이스를 만들 수 있고, 아니면 중간계층을 만들어서 해결할 수 있다.\
   b. 도메인 이벤트 퍼블리싱\
   order에서 shop과 delivery에 orderDeliveryEvent를 발행한다.\
   이때, shop과 orderDeliveryEvent사이에 양방향 의존이 발생하는데 이를 해결하려면\
   eventHandler를 shop에서 분리한다. 즉 shop 클래스를 billing으로 분리한 다음  billing과 orderDeliveryEvent는 이벤트 핸들러를 의존한다.\
   즉, 패키지 사이클이 발생할 경우에는 중간계층을 만들 수도 있고, 클래스를 2개로 분리할 수도 있다.

## 패키지 의존성 사이클 해결 방법 정리

1. 중간객체를 만든다.(중간객체를 참조한다.)
2. 인터페이스로 의존성을 역전시킨다.
3. 새로운 패키지나, 클래스를 추가(분리)한다.

각각 상황에 따라 적용한다.\
도메인 이벤트 사용시 도메인 단위로 의존성 사이클 발생. 하지만 도메인 단위를 분리할 경우 사이클을 제거할 수 있다.&#x20;

